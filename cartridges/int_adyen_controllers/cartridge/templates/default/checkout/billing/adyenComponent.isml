<iscontent type="text/html" encoding="off"/>
<isset name="AdyenGetOriginKey" value="${require('*/cartridge/scripts/adyenGetOriginKey')}" scope="page"/>
<isset name="AdyenHelper" value="${require('*/cartridge/scripts/util/AdyenHelper')}" scope="page"/>
<link rel="stylesheet" href="${URLUtils.staticURL('/css/adyenCSS.css')}" />

<isset name="methods" value="${pdict.AdyenPaymentMethods}" scope="page"/>

<link rel="stylesheet" type="text/css" href="${AdyenHelper.getCheckoutCSS()}"/>

<isscript>
    var getPaymentMethodsResponse = JSON.stringify(methods);
</isscript>

    <script>
    window.getPaymentMethodsResponse = JSON.parse(`${getPaymentMethodsResponse}`);
    var originKey = "${AdyenGetOriginKey.getOriginKeyFromRequest(request.getHttpProtocol(), request.getHttpHost())}";
    var loadingContext = "${AdyenHelper.getLoadingContext()}";
    var environment = "${AdyenHelper.getAdyenEnvironment().toLowerCase()}";
    var locale = "${request.locale}";
    window.Configuration = {originKey, loadingContext, environment, locale};
    window.installments = "${AdyenHelper.getCreditCardInstallments()}";

    var showStoreDetails = ${customer.authenticated};
</script>

<isset name="ratePayID" value="${AdyenHelper.getRatePayID()}" scope="page"/>

<input type="hidden" id="adyenStateData" name="${pdict.CurrentForms.adyPaydata.adyenStateData.htmlName}">
<!--<input id="adyenStateData" type="hidden" ${adyenPaymentFields.adyenStateData.attributes}/>-->
<!--<input type="text" class="form-control cardNumber" style="display:none" id="cardNumber" ${creditFields.cardNumber.attributes}>-->
<!--<input type="hidden" class="form-control" id="cardType" ${creditFields.cardType.attributes}>-->

<input id="adyenPaymentMethodName" type="hidden" name="adyenPaymentMethod"/>
<input id="adyenIssuerName" type="hidden" name="adyenIssuerName"/>
<!--<input id="selectedIssuer" type="hidden" ${adyenPaymentFields.issuer.attributes}/>-->

<ul id="paymentMethodsList"></ul>

<iscomment>
    Adyen RatePay Device Fingerprint Code
</iscomment>
<isif condition="${empty(session.privacy.ratePayFingerprint)}">
    <isscript>
        var ratePayID = dw.system.Site.getCurrent().getCustomPreferenceValue('AdyenRatePayID');
        var sessionID = new dw.crypto.MessageDigest(dw.crypto.MessageDigest.DIGEST_MD5).digest(session.sessionID);
        session.privacy.ratePayFingerprint = sessionID;
    </isscript>
    <script language="JavaScript">
        var di = {t:'${sessionID}',v:'${ratePayID}',l:'Checkout'};
    </script>
    <script type="text/javascript" src="//d.ratepay.com/${ratePayID}/di.js"></script>
</isif>

<iscomment>
    Adyen Generic Device Fingerprint Code
</iscomment>
<script type="text/javascript" src="https://live.adyen.com/hpp/js/df.js?v=${session.sessionID}"></script>
<isinputfield type="hidden" formfield="${pdict.CurrentForms.adyPaydata.adyenFingerprint}" />
<script type="text/javascript">
    dfDo('dwfrm_adyPaydata_adyenFingerprint');
</script>

<span id="errorLoadComponent"></span>
<div id="card"></div>